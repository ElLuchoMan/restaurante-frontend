# restaurante-front/.cursorrules
rules:
  - "Contexto: App de restaurante en Angular (standalone) con vistas de menú, carrito, checkout, perfiles y rutas por rol; estilos SCSS; posible SSR/SSG."
  - "Estilo y Calidad: ESLint + Prettier (eslint-config-prettier activo); imports ordenados; tipado estricto; evitar any; componentes pequeños y reutilizables; lógica en servicios; manejo de estado simple (o NgRx si ya está definido); tokens de diseño consistentes; ChangeDetectionStrategy.OnPush cuando aplique."
  - "Accesibilidad y Performance: usar atributos aria-; evitar layout shifts; lazy loading por rutas; dividir bundles; imágenes optimizadas; changeDetection cuando sea viable."
  - "Pruebas: Jest + @testing-library/angular + jest-dom; tests de componentes (render, eventos, accesibilidad), pipes y servicios; HttpTestingController para APIs; cobertura mínima definida; reutilizar mocks de src/app/shared/mocks y ajustarlos si es necesario, evitando mocks ad-hoc en los tests y teniendo en cuenta los datos ingresados en db, presentes en /context. OBLIGATORIO: Todo componente/servicio/pipe NUEVO debe incluir tests completos. Todo componente/servicio/pipe MODIFICADO debe tener sus tests corregidos/actualizados. META: 100% de cobertura (statements, branches, functions, lines) en archivos tocados antes de hacer push del commit."
  - "Validación local vs CI: SIEMPRE ejecutar 'npm test -- --ci --no-cache' localmente antes de hacer push para detectar problemas que solo aparecen en CI. Jest usa caché agresivo localmente que puede enmascarar errores (mocks incompletos, imports faltantes). El flag --ci desactiva caché, usa bail (detiene en primer error) y ejecuta con mayor aislamiento entre tests."
  - "Mocks: TODOS los datos mock (respuestas API, objetos de prueba) DEBEN estar en src/app/shared/mocks/ organizados por entidad (ej: telemetry.mock.ts, producto.mock.ts). Los test-doubles (servicios mock, funciones helper) van en test-doubles.ts. NUNCA crear mocks inline en archivos .spec.ts - siempre importarlos desde /mocks. Si el mock no existe, créalo en /mocks primero. PROHIBIDO usar jest.fn() directamente en .spec.ts - crear funciones helper en test-doubles.ts (ej: createUserServiceMock, createLocationMock, createCapacitorMock) que encapsulen jest.fn() y sean reutilizables. CRÍTICO: Las funciones helper DEBEN incluir TODOS los métodos públicos del servicio/clase original, no solo los que usa un test específico - mocks incompletos pasan localmente pero fallan en CI debido a diferencias de caché."
  - "Seguridad: sanitizar HTML; no almacenar PII; no hardcodear claves/endpoints privados; variables por entorno; validar inputs de formularios."
  - "Convenciones de Git: Conventional Commits (feat/ui:, fix/ui:, chore/deps:, perf/ui:, refactor/ui:); PRs con capturas o story si hay cambios visuales; commitlint + husky para validar mensajes."
  - "Ignorar: node_modules/, dist/, .angular/, coverage/, .env*, tmp/."
  - "Instrucciones IA: priorizar accesibilidad y performance; no introducir librerías nuevas sin justificación; sugerir lazy loading/guards/resolvers; generar tests cuando se propongan componentes/servicios; corregir tests con cada cambio para garantizar covertura del 100%; respetar stylelint para SCSS. Al crear funciones mock en test-doubles.ts, SIEMPRE leer el archivo del servicio/clase original completo para incluir TODOS los métodos públicos, no solo los que necesita un test específico. Validar con 'npm test -- --ci --no-cache' antes de considerar completa cualquier tarea de testing. WORKFLOW OBLIGATORIO: 1) Crear/modificar código, 2) Escribir/actualizar tests completos para 100% coverage del archivo tocado, 3) Ejecutar 'npm test -- --ci --no-cache' y verificar cobertura, 4) Solo entonces hacer commit. NO considerar completa una tarea hasta lograr 100% coverage (statements, branches, functions, lines) en archivos modificados."
  - "Estilos: Garantizar que todos los componentes creados y los que estemos modificando, tengan estilos que sean adecuados tanto para web como para webview."
  - "Diseño Estándar: Todas las tarjetas (.card) y tablas (.table) DEBEN seguir el estilo definido en _base.scss basado en el login: fondo blanco (#ffffff), bordes redondeados (20px), sombra elegante (0 20px 50px rgba(0,0,0,0.08)), borde sutil (1px solid #e5e7eb), padding generoso (2rem), efecto hover con elevación, tipografía clara con colores #2d3748 para títulos y #4a5568 para contenido. Este es el estilo oficial de 'El fogón DE MARÍA'."
  - "Integración con backend: Toda la información necesaria para construir Services, validar tests y crear mocks, está en restaurante-frontend\context, no creemos mocks, si es necesario, modifiquemos para que hagan match con los datos presentes en DB."
  - "WebView: Toda la información necesaria para construir el WebView, está en restaurante-frontend\docs\webview.md, no creemos mocks, si es necesario, modifiquemos para que hagan match con los datos presentes en DB."
  - "Webview: Todo cambio que hagamos en el WebView, es probado en el dispositivo real, no en el emulador. Adicionalmente, cuando se indique modificar el webview, no se debe modificar para web ni para web mobile, es decir, navegadores web y web mobile no deben ser afectados."
  - "Estilos globales: Siempre usaremos los estilos base de la app (variables y _base.scss) y evitaremos estilos personalizados en las hojas de estilo de los componentes; si existen, los migraremos a estilos globales reutilizables."
  - "Antes de crear o sugerir nuevos estilos, VALIDAR primero que no exista ya un patrón en src/assets/styles.scss (y sus _variables.scss/_base.scss/_utilities.scss). Todo componente debe tomar estilos desde allí."
  - "VALIDACIÓN DE VARIABLES SCSS: OBLIGATORIO leer src/assets/_variables.scss ANTES de escribir cualquier archivo SCSS. SOLO usar variables definidas en _variables.scss. Variables disponibles para texto: $text-heading-strong (títulos #212121), $text-body (contenido #424242), $text-muted (subtítulos #9e9e9e). NO USAR variables inexistentes como $text-primary, $text-secondary, $color-text, etc. Si una variable no existe en _variables.scss, NO inventarla - usar la variable correcta existente o solicitar agregar una nueva a _variables.scss primero. Este paso evita errores de compilación SCSS."
  - "Barra amarilla: usar el título estándar .section-title en todas las vistas."
  - "Margen superior desktop: envolver vistas en el contenedor .page-shell (excepto Not-found). Valor desktop: 4rem."
  - "Breakpoints oficiales: WEB DESKTOP >= 992px (lg Bootstrap); WEB MOBILE < 992px o cuando hay menú hamburguesa; WebView es nativo (capacitor/cordova) y sigue docs en docs/webview.md."
  - "Colores: Todo color DEBE venir de src/assets/_variables.scss (incluye rgba() precalculados). No se permiten hex/rgb/rgba literales en
  componentes/estilos; si falta un token, agregarlo a _variables.scss primero."
  - "Menús de Acciones: Toda ruta que presente múltiples opciones (crear, editar, consultar, ver, etc.) DEBE usar el patrón de menú estándar definido en _base.scss: .menu-grid (contenedor grid responsive), .menu-card (tarjeta con hover y barra lateral de color), .menu-card--{color} (variantes: blue, green, orange, red, purple, primary), .menu-card__icon (icono de 60x60px con fondo de color suave), .menu-card__content (título + descripción), .menu-card__arrow (flecha de navegación). Ejemplo: admin/acciones, admin/reservas. NO crear estilos personalizados para menús; usar las clases globales."
  - "Subtítulo en Menús: Todo menú de acciones DEBE incluir un subtítulo descriptivo debajo del título principal. Estructura: 1) Propiedad en el componente TypeScript: subtitulo = 'Descripción breve y clara'; 2) HTML: <p class='subtitle text-center mb-4'>{{ subtitulo }}</p> después del <h1 class='section-title'>; 3) SCSS: .subtitle con color #6b7280 y font-size 0.95rem. El subtítulo debe describir brevemente el propósito del menú."
  - "Navegación: NO incluir botones 'Volver al Menú' ni similares dentro de los componentes. La navegación se maneja con el botón 'Volver' de la barra superior (elemento amarillo en el header) que es común a todas las pantallas. Los componentes solo deben mostrar su contenido sin elementos de navegación redundantes."
