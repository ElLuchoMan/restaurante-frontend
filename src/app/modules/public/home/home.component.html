<!-- Hero simplificado - Solo para WEB, no para WebView nativo -->
<div
  class="container-fluid p-0 home-hero"
  *ngIf="!isWebView"
  aria-label="Bienvenida a El fogón DE MARÍA"
>
  <div class="hero-single position-relative">
    <img
      class="img-responsive"
      ngSrc="assets/img/carousel-1-1200.webp"
      rawSrcset="assets/img/carousel-1-768.webp 768w, assets/img/carousel-1-1200.webp 1200w"
      sizes="100vw"
      alt="El fogón DE MARÍA - Restaurante colombiano"
      priority
      fill
      (error)="onImageError($event)"
    />
    <div
      class="hero-caption d-flex flex-column align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100"
    >
      <div class="p-3 bg-text caption-card text-center">
        <h1 class="caption-eyebrow mb-2">El fogón DE MARÍA</h1>
        <p class="caption-title mb-3">Tradición colombiana reinventada</p>
        <a
          routerLink="/menu"
          class="btn btn-primary btn-lg mt-1"
          aria-label="Descubrir nuestro menú"
          >Descubrir Menú</a
        >
      </div>
    </div>
  </div>
</div>

<!-- Sección de estadísticas destacadas - Solo para WEB, innecesario en WebView -->
<div class="container-fluid py-4 home-stats" *ngIf="!isWebView">
  <div class="container">
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-star" aria-hidden="true"></i>
          </div>
          <div class="stat-number">4.8</div>
          <div class="stat-label">Calificación</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-utensils" aria-hidden="true"></i>
          </div>
          <div class="stat-number">50+</div>
          <div class="stat-label">Platos</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-clock" aria-hidden="true"></i>
          </div>
          <div class="stat-number">25min</div>
          <div class="stat-label">Entrega</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-users" aria-hidden="true"></i>
          </div>
          <div class="stat-number">1000+</div>
          <div class="stat-label">Clientes</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sección de Ofertas Especiales -->
<div class="container-fluid py-5 home-offers" [class.webview-top-margin]="isWebView">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Ofertas Especiales <span class="d-block subtitle">¡Por tiempo limitado!</span>
        </h2>
      </div>
    </div>
    <!-- Vista WEB: Grid responsivo -->
    <div class="row g-4" *ngIf="!isWebView">
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge">¡NUEVO!</div>
          <div class="offer-image">
            <img
              src="assets/img/product-1.webp"
              alt="Combo Tradicional"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>Combo Tradicional</h3>
            <p>Bandeja paisa + bebida + postre</p>
            <div class="price-display">
              <span class="old-price">$35.000</span>
              <span class="new-price">$28.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Pedir Ahora</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge hot">🔥 HOT</div>
          <div class="offer-image">
            <img
              src="assets/img/product-2.webp"
              alt="2x1 Bebidas"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>2x1 en Bebidas</h3>
            <p>Válido en jugos naturales y gaseosas</p>
            <div class="price-display">
              <span class="new-price">Desde $8.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-secondary btn-sm">Aprovechar Oferta</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge weekend">FIN DE SEMANA</div>
          <div class="offer-image">
            <img
              src="assets/img/product-3.webp"
              alt="Brunch Especial"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>Brunch Especial</h3>
            <p>Desayuno + almuerzo fusión</p>
            <div class="price-display">
              <span class="new-price">$22.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Probar Brunch</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista WEBVIEW: Carrusel horizontal compacto -->
    <div class="horizontal-carousel" *ngIf="isWebView">
      <div class="carousel-container">
        <div class="offer-card-mobile">
          <div class="offer-badge">¡NUEVO!</div>
          <div class="offer-image-mobile">
            <img
              src="assets/img/product-1.webp"
              alt="Combo Tradicional"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content-mobile">
            <h4>Combo Tradicional</h4>
            <p class="small">Bandeja paisa + bebida + postre</p>
            <div class="price-mobile">
              <span class="old-price">$35.000</span>
              <span class="new-price">$28.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Pedir</a>
          </div>
        </div>
        <div class="offer-card-mobile">
          <div class="offer-badge hot">🔥 HOT</div>
          <div class="offer-image-mobile">
            <img
              src="assets/img/product-2.webp"
              alt="2x1 Bebidas"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content-mobile">
            <h4>2x1 en Bebidas</h4>
            <p class="small">Válido en jugos naturales y gaseosas</p>
            <div class="price-mobile">
              <span class="new-price">Desde $8.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-secondary btn-sm">Aprovechar</a>
          </div>
        </div>
        <div class="offer-card-mobile">
          <div class="offer-badge weekend">FIN DE SEMANA</div>
          <div class="offer-image-mobile">
            <img
              src="assets/img/product-3.webp"
              alt="Brunch Especial"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content-mobile">
            <h4>Brunch Especial</h4>
            <p class="small">Desayuno + almuerzo fusión</p>
            <div class="price-mobile">
              <span class="new-price">$22.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Probar</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sección About - Solo para WEB, demasiado texto para WebView -->
<div class="container-fluid py-5 home-about" *ngIf="!isWebView">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <h2 class="section-title position-relative text-center mb-5">
          Innovación con sabor colombiano <span class="d-block subtitle">Desde 2025</span>
        </h2>
      </div>
    </div>
    <div class="row align-items-stretch g-4">
      <div class="col-12 col-md-6 col-lg-4 py-4">
        <h3 class="font-weight-bold mb-3">El fogón DE MARÍA</h3>
        <p class="text-muted lead-sm mb-3">Tradición colombiana reinventada</p>
        <p class="mb-3">
          Celebramos la riqueza de nuestra gastronomía reinventando platos tradicionales con un
          toque innovador, sin olvidar los clásicos que todos aman.
        </p>
        <div class="feature-highlights">
          <p class="text-muted mb-2 feature-item">
            <i class="fa fa-utensils text-secondary me-3"></i
            ><strong>Platos únicos:</strong> Hamburguesas con arepa, tacos costeños
          </p>
          <p class="text-muted mb-2 feature-item">
            <i class="fa fa-leaf text-secondary me-3"></i
            ><strong>Ingredientes frescos:</strong> Productos locales de calidad
          </p>
          <p class="text-muted mb-3 feature-item">
            <i class="fa fa-heart text-secondary me-3"></i
            ><strong>Experiencia única:</strong> Tradición + innovación en cada bocado
          </p>
        </div>
        <!-- Botón "Leer Más" eliminado para reducir CTAs y evitar competencia -->
      </div>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="position-relative about-image rounded overflow-hidden">
          <img
            class="position-absolute w-100 h-100"
            ngSrc="assets/img/about2.webp"
            alt="descriptive image"
            style="object-fit: cover"
            loading="lazy"
            decoding="async"
            sizes="(min-width: 992px) 33vw, (min-width: 768px) 50vw, 100vw"
            fetchpriority="low"
            fill
          />
        </div>
      </div>

      <div class="col-12 col-lg-4 py-4">
        <h3 class="font-weight-bold mb-3">¿Por qué elegirnos?</h3>
        <p class="mb-4">
          Tradición e innovación se unen para crear sabores únicos que resaltan lo mejor de la
          gastronomía colombiana.
        </p>
        <div class="why-choose-us">
          <p class="text-muted mb-3 feature-item">
            <i class="fa fa-medal text-secondary me-3"></i
            ><strong>Calidad garantizada:</strong> 4.8★ de calificación
          </p>
          <p class="text-muted mb-3 feature-item">
            <i class="fa fa-clock text-secondary me-3"></i><strong>Entrega rápida:</strong> 25min
            promedio
          </p>
          <p class="text-muted mb-4 feature-item">
            <i class="fa fa-users text-secondary me-3"></i><strong>Confianza:</strong> +1000
            clientes satisfechos
          </p>
        </div>
        <div class="text-center">
          <a
            routerLink="/menu"
            class="btn btn-primary mt-2 d-inline-block"
            aria-label="Explorar nuestro menú innovador"
            >Explorar Menú</a
          >
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Galería de Platos Destacados -->
<div class="container-fluid py-5 home-gallery">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Nuestros Platos Estrella <span class="d-block subtitle">Sabores que enamoran</span>
        </h2>
      </div>
    </div>
    <!-- Vista WEB: Grid responsivo -->
    <div class="row g-3" *ngIf="!isWebView">
      <!-- Loading state -->
      <ng-container *ngIf="loadingProductos">
        <div class="col-12 text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando productos populares...</span>
          </div>
          <p class="mt-2 text-muted">Cargando nuestros platos más populares...</p>
        </div>
      </ng-container>

      <!-- Error state -->
      <ng-container *ngIf="errorProductos && !loadingProductos">
        <div class="col-12 text-center py-4">
          <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            No pudimos cargar los platos en este momento.
            <button
              type="button"
              class="btn btn-sm btn-outline-primary ms-2"
              (click)="loadProductosPopulares()"
            >
              Reintentar
            </button>
          </div>
        </div>
      </ng-container>

      <!-- Success state - Productos dinámicos -->
      <ng-container *ngIf="!loadingProductos && !errorProductos && productosPopulares.length > 0">
        <div
          class="col-6 col-md-4 col-lg-3"
          *ngFor="let producto of productosPopulares; let i = index; trackBy: trackByProductoId"
        >
          <div class="gallery-item">
            <!-- Usar imágenes estáticas como fallback para evitar el error 431 -->
            <img
              [src]="getProductImageSrcByIndex(producto, i)"
              [alt]="producto.nombreProducto"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div class="gallery-overlay">
              <h4>{{ producto.nombreProducto }}</h4>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Fallback cuando no hay productos -->
      <ng-container *ngIf="!loadingProductos && !errorProductos && productosPopulares.length === 0">
        <div class="col-12 text-center py-4">
          <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            No hay productos populares disponibles en este momento.
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Vista WEBVIEW: Carrusel horizontal compacto para platos estrella -->
    <div class="horizontal-carousel" *ngIf="isWebView">
      <!-- Loading state -->
      <div class="text-center py-4" *ngIf="loadingProductos">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando productos populares...</span>
        </div>
        <p class="mt-2 text-muted small">Cargando platos...</p>
      </div>

      <!-- Error state -->
      <div class="text-center py-4" *ngIf="errorProductos && !loadingProductos">
        <p class="text-warning small mb-2">No pudimos cargar los platos</p>
        <button
          type="button"
          class="btn btn-sm btn-outline-primary"
          (click)="loadProductosPopulares()"
        >
          Reintentar
        </button>
      </div>

      <!-- Success state - Productos dinámicos en carrusel -->
      <div
        class="carousel-container"
        *ngIf="!loadingProductos && !errorProductos && productosPopulares.length > 0"
      >
        <div
          class="product-card-mobile"
          *ngFor="let producto of productosPopulares; let i = index; trackBy: trackByProductoId"
        >
          <div class="product-image-mobile">
            <img
              [src]="getProductImageSrcByIndex(producto, i)"
              [alt]="producto.nombreProducto"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div class="product-overlay-mobile">
              <span class="product-price">${{ producto.precio | number: '1.0-0' }}</span>
            </div>
          </div>
          <div class="product-content-mobile">
            <h5>{{ producto.nombreProducto }}</h5>
            <a routerLink="/menu" class="btn btn-outline-primary btn-sm">Ver</a>
          </div>
        </div>
      </div>

      <!-- Fallback cuando no hay productos -->
      <div
        class="text-center py-4"
        *ngIf="!loadingProductos && !errorProductos && productosPopulares.length === 0"
      >
        <p class="text-muted small">No hay productos disponibles</p>
      </div>
    </div>
    <div class="text-center mt-4">
      <a routerLink="/menu" class="btn btn-primary btn-lg">Ver Menú Completo</a>
    </div>
  </div>
</div>

<!-- Info rápida de contacto - Solo para WebView -->
<div class="container-fluid py-4" *ngIf="isWebView">
  <div class="container">
    <div class="row g-3">
      <div class="col-6">
        <a routerLink="/ubicacion" class="quick-info-card text-decoration-none">
          <div class="card h-100 text-center">
            <div class="card-body d-flex flex-column justify-content-center">
              <i class="fa fa-map-marker-alt text-primary mb-2" style="font-size: 1.5rem"></i>
              <h6 class="mb-1">Ubicación</h6>
              <p class="small text-muted mb-0">Calle 78a # 62 - 48, Bogotá, Colombia</p>
            </div>
          </div>
        </a>
      </div>
      <div class="col-6">
        <a href="tel:3042449339" class="quick-info-card text-decoration-none">
          <div class="card h-100 text-center">
            <div class="card-body d-flex flex-column justify-content-center">
              <i class="fa fa-phone text-success mb-2" style="font-size: 1.5rem"></i>
              <h6 class="mb-1">Llamar</h6>
              <p class="small text-muted mb-0">3042449339</p>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Acceso directo al carrito - Solo para WebView si hay items -->
<div class="container-fluid py-3" *ngIf="isWebView && cartCount > 0">
  <div class="container">
    <a routerLink="/client/carrito" class="btn btn-success w-100 py-3">
      <i class="fa fa-shopping-cart me-2"></i>
      Ver mi carrito ({{ cartCount }} {{ cartCount === 1 ? 'item' : 'items' }})
    </a>
  </div>
</div>

<!-- Acceso rápido para usuarios logueados - Solo para WebView -->
<div class="container-fluid py-3" *ngIf="isWebView && !(isLoggedOut$ | async)">
  <div class="container">
    <div class="row g-3">
      <div class="col-6">
        <a routerLink="/cliente/mis-pedidos" class="text-decoration-none">
          <div class="card h-100 text-center">
            <div class="card-body d-flex flex-column justify-content-center">
              <i class="fa fa-history text-info mb-2" style="font-size: 1.5rem"></i>
              <h6 class="mb-0">Mis Pedidos</h6>
            </div>
          </div>
        </a>
      </div>
      <div class="col-6">
        <a routerLink="/cliente/perfil" class="text-decoration-none">
          <div class="card h-100 text-center">
            <div class="card-body d-flex flex-column justify-content-center">
              <i class="fa fa-user text-warning mb-2" style="font-size: 1.5rem"></i>
              <h6 class="mb-0">Mi Perfil</h6>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Sección de Testimonios - Solo para WEB, no crítico en WebView -->
<div class="container-fluid py-5 home-testimonials" *ngIf="!isWebView">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Lo que Dicen Nuestros Clientes <span class="d-block subtitle">Experiencias reales</span>
        </h2>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "La mejor arepa rellena que he probado en Bogotá. La combinación de sabores
            tradicionales con toques modernos es increíble."
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-1.webp"
              alt="María González"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>María González</h5>
              <span>Cliente frecuente</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "El servicio es excelente y la comida llega súper rápido. Los tacos costeños son mi
            debilidad, ¡no puedo parar de pedirlos!"
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-2.webp"
              alt="Carlos Rodríguez"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>Carlos Rodríguez</h5>
              <span>Foodie bogotano</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "Perfecto para almorzar en familia. Los niños aman las hamburguesas colombianas y
            nosotros la bandeja paisa reinventada."
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-3.webp"
              alt="Ana Martínez"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>Ana Martínez</h5>
              <span>Mamá de familia</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Call to Action Principal - Solo para WEB, redundante en WebView -->
<div class="container-fluid py-5 home-cta" *ngIf="!isWebView">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h2 class="cta-title mb-3">¿Listo para una Experiencia Única?</h2>
        <p class="cta-subtitle mb-4">Descubre por qué somos el restaurante favorito de Bogotá</p>
        <div class="cta-buttons">
          <a routerLink="/menu" class="btn btn-primary btn-lg me-3 mb-2">
            <i class="fa fa-utensils me-2"></i>Ver Menú
          </a>
          <a routerLink="/reservas/crear" class="btn btn-secondary btn-lg mb-2">
            <i class="fa fa-calendar me-2"></i>Reservar Mesa
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Acciones rápidas: mobile web para todos los usuarios. En webview ya existe global -->
<div class="quick-actions-bar d-md-none" *ngIf="!isWebView">
  <nav class="container quick-actions" aria-label="Acciones rápidas">
    <div class="row g-3">
      <div class="col-3">
        <a routerLink="/menu" class="qa-item" aria-label="Ir al menú">
          <i class="fa fa-utensils" aria-hidden="true"></i>
          <span>Menú</span>
        </a>
      </div>
      <div class="col-3">
        <a routerLink="/reservas/crear" class="qa-item" aria-label="Crear reserva">
          <i class="fa fa-calendar" aria-hidden="true"></i>
          <span>Reservar</span>
        </a>
      </div>
      <div class="col-3">
        <a routerLink="/ubicacion" class="qa-item" aria-label="Ver ubicación">
          <i class="fa fa-map-marker-alt" aria-hidden="true"></i>
          <span>Ubicación</span>
        </a>
      </div>
      <div class="col-3" *ngIf="isLoggedOut$ | async; else profileLink">
        <a routerLink="/login" class="qa-item" aria-label="Iniciar sesión">
          <i class="fa fa-sign-in-alt" aria-hidden="true"></i>
          <span>Login</span>
        </a>
      </div>
      <ng-template #profileLink>
        <div class="col-3">
          <a routerLink="/client/profile" class="qa-item" aria-label="Mi perfil">
            <i class="fa fa-user" aria-hidden="true"></i>
            <span>Perfil</span>
          </a>
        </div>
      </ng-template>
    </div>
  </nav>
</div>
