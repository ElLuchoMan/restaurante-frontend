<!-- La topbar del home se eliminó porque en navegadores web siempre existe el header principal -->
<!-- En webview se usa la native-topbar global, por eso no necesitamos topbar aquí -->

<div class="container-fluid p-0 home-hero" aria-label="Promociones destacadas">
  <div
    id="header-carousel"
    class="carousel slide carousel-fade"
    data-bs-ride="carousel"
    data-bs-interval="5000"
    data-bs-pause="false"
    data-bs-wrap="true"
  >
    <div class="carousel-inner" role="listbox">
      <div
        class="carousel-item active"
        role="group"
        aria-roledescription="slide"
        aria-label="1 de 3"
      >
        <img
          class="w-100 img-responsive"
          ngSrc="assets/img/carousel-1-1200.webp"
          rawSrcset="assets/img/carousel-1-768.webp 768w, assets/img/carousel-1-1200.webp 1200w"
          sizes="100vw"
          alt="Carrusel 1"
          priority
          width="1200"
          height="686"
          (error)="onImageError($event)"
        />
        <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
          <div class="p-3 bg-text caption-card">
            <h2 class="caption-eyebrow mb-2">Tradición Colombiana reinventada</h2>
            <p class="caption-title mb-3">Un bocado de innovación</p>
            <a routerLink="/menu" class="btn btn-primary btn-lg-mobile mt-1" aria-label="Ver menú"
              >Ver Menú</a
            >
          </div>
        </div>
      </div>
      <div class="carousel-item" role="group" aria-roledescription="slide" aria-label="2 de 3">
        <img
          class="w-100 img-responsive"
          ngSrc="assets/img/carousel-2-1200.webp"
          rawSrcset="assets/img/carousel-2-768.webp 768w, assets/img/carousel-2-1200.webp 1200w"
          sizes="100vw"
          alt="Carrusel 2"
          loading="lazy"
          decoding="async"
          width="1200"
          height="686"
          (error)="onImageError($event)"
        />
        <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
          <div class="p-3 bg-text caption-card">
            <h2 class="caption-eyebrow mb-2">Sabores auténticos</h2>
            <p class="caption-title mb-3">Lo mejor de nuestra tierra</p>
            <a routerLink="/menu" class="btn btn-primary btn-lg-mobile mt-1" aria-label="Ver menú"
              >Ver Menú</a
            >
          </div>
        </div>
      </div>
      <div class="carousel-item" role="group" aria-roledescription="slide" aria-label="3 de 3">
        <img
          class="w-100 img-responsive"
          ngSrc="assets/img/carousel-3-1200.webp"
          rawSrcset="assets/img/carousel-3-768.webp 768w, assets/img/carousel-3-1200.webp 1200w"
          sizes="100vw"
          alt="Carrusel 3"
          loading="lazy"
          decoding="async"
          width="1200"
          height="686"
          (error)="onImageError($event)"
        />
        <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
          <div class="p-3 bg-text caption-card">
            <h2 class="caption-eyebrow mb-2">Para los más arriesgados</h2>
            <p class="caption-title mb-3">Descubre sabores únicos</p>
            <a routerLink="/menu" class="btn btn-primary btn-lg-mobile mt-1" aria-label="Ver menú"
              >Ver Menú</a
            >
          </div>
        </div>
      </div>
    </div>
    <a
      class="carousel-control-prev"
      href="#header-carousel"
      data-bs-slide="prev"
      aria-label="Anterior"
    >
      <div class="btn btn-secondary px-0 control-circle">
        <span class="carousel-control-prev-icon mb-n1"></span>
      </div>
    </a>
    <a
      class="carousel-control-next"
      href="#header-carousel"
      data-bs-slide="next"
      aria-label="Siguiente"
    >
      <div class="btn btn-secondary px-0 control-circle">
        <span class="carousel-control-next-icon mb-n1"></span>
      </div>
    </a>
  </div>
</div>

<!-- Sección de estadísticas destacadas -->
<div class="container-fluid py-4 home-stats" *ngIf="isWebView">
  <div class="container">
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-star" aria-hidden="true"></i>
          </div>
          <div class="stat-number">4.8</div>
          <div class="stat-label">Calificación</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-utensils" aria-hidden="true"></i>
          </div>
          <div class="stat-number">50+</div>
          <div class="stat-label">Platos</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-clock" aria-hidden="true"></i>
          </div>
          <div class="stat-number">25min</div>
          <div class="stat-label">Entrega</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fa fa-users" aria-hidden="true"></i>
          </div>
          <div class="stat-number">1000+</div>
          <div class="stat-label">Clientes</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sección de Ofertas Especiales -->
<div class="container-fluid py-5 home-offers">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Ofertas Especiales <span class="d-block subtitle">¡Por tiempo limitado!</span>
        </h2>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge">¡NUEVO!</div>
          <div class="offer-image">
            <img
              src="assets/img/product-1.webp"
              alt="Combo Tradicional"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>Combo Tradicional</h3>
            <p>Bandeja paisa + bebida + postre</p>
            <div class="offer-price">
              <span class="old-price">$35.000</span>
              <span class="new-price">$28.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Ver Menú</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge hot">🔥 HOT</div>
          <div class="offer-image">
            <img
              src="assets/img/product-2.webp"
              alt="2x1 Bebidas"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>2x1 en Bebidas</h3>
            <p>Válido en jugos naturales y gaseosas</p>
            <div class="offer-price">
              <span class="new-price">Desde $8.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-secondary btn-sm">Aprovechar</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="offer-card">
          <div class="offer-badge weekend">FIN DE SEMANA</div>
          <div class="offer-image">
            <img
              src="assets/img/product-3.webp"
              alt="Brunch Especial"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>
          <div class="offer-content">
            <h3>Brunch Especial</h3>
            <p>Desayuno + almuerzo fusión</p>
            <div class="offer-price">
              <span class="new-price">$22.000</span>
            </div>
            <a routerLink="/menu" class="btn btn-primary btn-sm">Descubrir</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Eliminado espaciador: la barra ahora se oculta al ver el footer -->
<div class="container-fluid py-5 home-about">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <h2 class="section-title position-relative text-center mb-5">
          Innovación con sabor colombiano <span class="d-block subtitle">Desde 2025</span>
        </h2>
      </div>
    </div>
    <div class="row align-items-stretch g-4">
      <div class="col-12 col-md-6 col-lg-4 py-4 text-center text-md-start">
        <h3 class="font-weight-bold mb-2">Acerca de nosotros</h3>
        <p class="text-muted lead-sm mb-3">Tradición y creatividad en un bocado</p>
        <p>
          Celebramos la riqueza de la gastronomía colombiana reinventando platos tradicionales con
          un toque innovador, sin dejar atrás las opciones clásicas que todos aman. Desde
          hamburguesas con arepas hasta tacos y burritos con sabores locales, ofrecemos una
          experiencia única que combina tradición y creatividad, diseñada para sorprender y deleitar
          a todos nuestros comensales.
        </p>
        <a
          routerLink="/nosotros"
          class="btn btn-secondary mt-2"
          aria-label="Leer más sobre nosotros"
          >Leer Más</a
        >
      </div>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="position-relative about-image rounded overflow-hidden">
          <img
            class="position-absolute w-100 h-100"
            ngSrc="assets/img/about2.webp"
            alt="descriptive image"
            style="object-fit: cover"
            loading="lazy"
            decoding="async"
            sizes="(min-width: 992px) 33vw, (min-width: 768px) 50vw, 100vw"
            fetchpriority="low"
            fill
          />
        </div>
      </div>

      <div class="col-12 col-lg-4 py-4">
        <h3 class="font-weight-bold mb-3 text-center text-lg-start">Lo que nos hace únicos</h3>
        <p>
          En nuestro restaurante, tradición e innovación se unen para ofrecer sabores únicos.
          Disfruta de opciones tradicionales y platos reinventados que resaltan lo mejor de la
          gastronomía colombiana.
        </p>
        <p class="text-muted mb-2 feature-item">
          <i class="fa fa-check text-secondary mr-3"></i>Platos internacionales reinventandos
        </p>
        <p class="text-muted mb-2 feature-item">
          <i class="fa fa-check text-secondary mr-3"></i>Ingredientes locales y frescos
        </p>
        <p class="text-muted mb-3 feature-item">
          <i class="fa fa-check text-secondary mr-3"></i>Experiencia gastronómica única y auténtica
        </p>
        <div class="text-center">
          <a
            routerLink="/menu"
            class="btn btn-primary mt-2 d-inline-block"
            aria-label="Descubrir más del menú"
            >Descubre Más</a
          >
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Galería de Platos Destacados -->
<div class="container-fluid py-5 home-gallery">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Nuestros Platos Estrella <span class="d-block subtitle">Sabores que enamoran</span>
        </h2>
      </div>
    </div>
    <div class="row g-3">
      <!-- Loading state -->
      <ng-container *ngIf="loadingProductos">
        <div class="col-12 text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando productos populares...</span>
          </div>
          <p class="mt-2 text-muted">Cargando nuestros platos más populares...</p>
        </div>
      </ng-container>

      <!-- Error state -->
      <ng-container *ngIf="errorProductos && !loadingProductos">
        <div class="col-12 text-center py-4">
          <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            No pudimos cargar los platos en este momento.
            <button
              type="button"
              class="btn btn-sm btn-outline-primary ms-2"
              (click)="loadProductosPopulares()"
            >
              Reintentar
            </button>
          </div>
        </div>
      </ng-container>

      <!-- Success state - Productos dinámicos -->
      <ng-container *ngIf="!loadingProductos && !errorProductos && productosPopulares.length > 0">
        <div
          class="col-6 col-md-4 col-lg-3"
          *ngFor="let producto of productosPopulares; let i = index; trackBy: trackByProductoId"
        >
          <div class="gallery-item">
            <!-- Usar imágenes estáticas como fallback para evitar el error 431 -->
            <img
              [src]="getProductImageSrcByIndex(producto, i)"
              [alt]="producto.nombreProducto"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div class="gallery-overlay">
              <h4>{{ producto.nombreProducto }}</h4>
              <p>
                {{ producto.cantidadVendida }} vendidos
                <span class="d-block fw-bold text-warning">
                  ${{ producto.precio | number: '1.0-0' }}
                </span>
              </p>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Fallback cuando no hay productos -->
      <ng-container *ngIf="!loadingProductos && !errorProductos && productosPopulares.length === 0">
        <div class="col-12 text-center py-4">
          <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            No hay productos populares disponibles en este momento.
          </div>
        </div>
      </ng-container>
    </div>
    <div class="text-center mt-4">
      <a routerLink="/menu" class="btn btn-primary btn-lg">Ver Menú Completo</a>
    </div>
  </div>
</div>

<!-- Sección de Testimonios -->
<div class="container-fluid py-5 home-testimonials">
  <div class="container">
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <h2 class="section-title position-relative mb-3">
          Lo que Dicen Nuestros Clientes <span class="d-block subtitle">Experiencias reales</span>
        </h2>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "La mejor arepa rellena que he probado en Bogotá. La combinación de sabores
            tradicionales con toques modernos es increíble."
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-1.webp"
              alt="María González"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>María González</h5>
              <span>Cliente frecuente</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "El servicio es excelente y la comida llega súper rápido. Los tacos costeños son mi
            debilidad, ¡no puedo parar de pedirlos!"
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-2.webp"
              alt="Carlos Rodríguez"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>Carlos Rodríguez</h5>
              <span>Foodie bogotano</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="testimonial-card">
          <div class="testimonial-stars">
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
          </div>
          <p>
            "Perfecto para almorzar en familia. Los niños aman las hamburguesas colombianas y
            nosotros la bandeja paisa reinventada."
          </p>
          <div class="testimonial-author">
            <img
              src="assets/img/testimonial-3.webp"
              alt="Ana Martínez"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div>
              <h5>Ana Martínez</h5>
              <span>Mamá de familia</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Call to Action Principal -->
<div class="container-fluid py-5 home-cta">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h2 class="cta-title mb-3">¿Listo para una Experiencia Única?</h2>
        <p class="cta-subtitle mb-4">Descubre por qué somos el restaurante favorito de Bogotá</p>
        <div class="cta-buttons">
          <a routerLink="/menu" class="btn btn-primary btn-lg me-3 mb-2">
            <i class="fa fa-utensils me-2"></i>Ver Menú
          </a>
          <a routerLink="/reservas/crear" class="btn btn-secondary btn-lg mb-2">
            <i class="fa fa-calendar me-2"></i>Reservar Mesa
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Acciones rápidas: solo mobile web (invitados). En webview ya existe global -->
<div class="quick-actions-bar d-md-none" *ngIf="(isLoggedOut$ | async) && !isWebView">
  <nav class="container quick-actions" aria-label="Acciones rápidas">
    <div class="row g-3">
      <div class="col-3">
        <a routerLink="/menu" class="qa-item" aria-label="Ir al menú">
          <i class="fa fa-utensils" aria-hidden="true"></i>
          <span>Menú</span>
        </a>
      </div>
      <div class="col-3">
        <a routerLink="/reservas/crear" class="qa-item" aria-label="Crear reserva">
          <i class="fa fa-calendar" aria-hidden="true"></i>
          <span>Reservar</span>
        </a>
      </div>
      <div class="col-3">
        <a routerLink="/ubicacion" class="qa-item" aria-label="Ver ubicación">
          <i class="fa fa-map-marker-alt" aria-hidden="true"></i>
          <span>Ubicación</span>
        </a>
      </div>
      <div class="col-3">
        <a routerLink="/login" class="qa-item" aria-label="Iniciar sesión">
          <i class="fa fa-sign-in-alt" aria-hidden="true"></i>
          <span>Login</span>
        </a>
      </div>
    </div>
  </nav>
</div>
